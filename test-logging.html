<!DOCTYPE html>
<html>
<head>
    <title>Test BlockMediator Logging</title>
    <style>
        .contextual-content {
            border: 2px solid blue;
            padding: 10px;
            margin: 10px 0;
        }
        .hidden {
            display: none;
        }
    </style>
</head>
<body>
    <h1>Test BlockMediator Logging</h1>
    
    <!-- Test conditional content with BlockMediator -->
    <p>[[allow-wait-listing&@BM.rsvpData.registrationStatus!=registered&@BM.eventData.isFull?(This event has reached capacity. Join the waitlist to receive a notification if a spot opens up.):()]]</p>
    
    <!-- Test simple conditional -->
    <p>[[is-full?(Event is full.):(Event has spots.)]]</p>

    <script>
        // Mock metadata
        const mockMetadata = {
            'allow-wait-listing': 'true',
            'is-full': 'true'
        };
        
        // Mock getMetadata function
        window.getMetadata = function(name) {
            return mockMetadata[name];
        };
        
        // Mock BlockMediator with logging
        window.BlockMediator = {
            stores: {
                rsvpData: {
                    registrationStatus: 'waitlisted' // Different from 'registered'
                },
                eventData: {
                    isFull: true
                }
            },
            get: function(storeName) {
                console.log(`[BlockMediator] Getting store: ${storeName}`);
                return this.stores[storeName];
            },
            subscribe: function(storeName, callback) {
                console.log(`[BlockMediator] Subscribing to store: ${storeName}`);
                // Simulate store updates after 2 seconds
                setTimeout(() => {
                    console.log(`[BlockMediator] Simulating update for store: ${storeName}`);
                    callback({ newValue: this.stores[storeName] });
                }, 2000);
            }
        };
        
        console.log('Starting test...');
    </script>
    
    <script type="module">
        // Import and run the content update
        import('./events/scripts/content-update.js').then(module => {
            const { default: autoUpdateContent } = module;
            
            console.log('Module loaded, running autoUpdateContent...');
            
            // Mock miloDeps
            const miloDeps = {
                getConfig: () => ({ locale: { ietf: 'en-US' } }),
                miloLibs: '/libs'
            };
            
            // Run the content update
            autoUpdateContent(document.body, miloDeps, {});
            
            console.log('autoUpdateContent completed');
        }).catch(error => {
            console.error('Error loading module:', error);
        });
    </script>
</body>
</html>
